# X-RAS-PINN ä½¿ç”¨æŒ‡å—

## ğŸ“¦ æ–‡ä»¶æ¸…å•

æä¾›çš„æ–‡ä»¶åŒ…æ‹¬ï¼š

1. **phase_field_vpinn.py** - ä¸»ä»£ç æ–‡ä»¶ï¼ˆåŒ…å« Phase-1 å’Œ Phase-2ï¼‰
2. **test_xras_pinn.py** - å®Œæ•´æµ‹è¯•ç¤ºä¾‹ï¼ˆè¾¹ç¼˜è£‚çº¹é—®é¢˜ï¼‰
3. **quick_test.py** - å¿«é€ŸéªŒè¯æµ‹è¯•ï¼ˆå°å‚æ•°ï¼‰
4. **README.md** - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
pip install torch numpy matplotlib
```

### æ­¥éª¤ 2: å¿«é€ŸéªŒè¯ï¼ˆæ¨èå…ˆè¿è¡Œï¼‰

```bash
python quick_test.py
```

è¿™å°†è¿è¡Œä¸€ä¸ªå¿«é€Ÿæµ‹è¯•ï¼ˆçº¦2-3åˆ†é’Ÿï¼‰ï¼ŒéªŒè¯æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼š
- âœ“ åŸŸåˆ†è§£
- âœ“ ä¸‰é˜¶æ®µè®­ç»ƒ
- âœ“ è‡ªé€‚åº”é‡‡æ ·
- âœ“ æ¥å£æŸå¤±
- âœ“ é¢„æµ‹åŠŸèƒ½

### æ­¥éª¤ 3: è¿è¡Œå®Œæ•´ç¤ºä¾‹

```bash
python test_xras_pinn.py
```

è¿™å°†è¿è¡Œå®Œæ•´çš„è¾¹ç¼˜è£‚çº¹æ‹‰ä¼¸é—®é¢˜ï¼ˆçº¦10-15åˆ†é’Ÿï¼‰ï¼Œç”Ÿæˆï¼š
- `figs/xras_sampling_scatter.png` - é‡‡æ ·ç‚¹åˆ†å¸ƒå›¾
- `figs/xras_solution_fields.png` - è§£åœºå¯è§†åŒ–ï¼ˆä½ç§»ã€æŸä¼¤ï¼‰

## ğŸ“‹ éªŒæ”¶æ ‡å‡†æ£€æŸ¥æ¸…å•

æ ¹æ® Phase-2 è¦æ±‚ï¼Œå®ç°åŒ…å«ï¼š

### 2.1 åŸŸåˆ†è§£ âœ“
```python
def partition_domain(x, crack_tip, r_sing)
    # åŸºäºè·ç¦»çš„åŸŸåˆ†åŒº
    # è¿”å› mask_sing, mask_far

def build_phase_field_network(high_capacity=True)
    # é«˜å®¹é‡ç½‘ç»œï¼ˆè£‚å°–åŒºï¼‰ï¼š[2, 128, 128, 128, 128, 2/1]
    # æ ‡å‡†å®¹é‡ç½‘ç»œï¼ˆè¿œåœºï¼‰ï¼š[2, 64, 64, 64, 2/1]
```

### 2.2 XPINN èƒ½é‡æŸå¤± âœ“
```python
def compute_xpinn_energy_loss(...)
    # L_total = L_energy_sing + L_energy_far + L_bc + L_interface
    # ä¸ä½¿ç”¨å¼ºå½¢å¼æ®‹å·® MSE_f
```

### 2.3 æ¥å£æŸå¤± âœ“
```python
def compute_interface_loss(u1, u2, x_I, d1, d2, ...)
    # ä½ç§»è¿ç»­: MSE_u = ||u1 - u2||Â²
    # ç‰µå¼•åŠ›å¹³è¡¡: MSE_trac = ||Ïƒ1Â·n1 + Ïƒ2Â·n2||Â²
    # åŒ…å« Nitsche's method çš„æ–‡æ¡£è¯´æ˜
```

### 2.4 è‡ªé€‚åº”é‡‡æ · âœ“
```python
def compute_indicator(u, d, x, ...)
    # eta_fused = (1-Î²)Â·sed_norm + Î²Â·grad_d_norm
    # SED = Ïƒ:Îµ, grad_d = ||âˆ‡d||

def resample_points(x_old, indicator, N_add)
    # p_i âˆ indicator_i
    # æœ‰æ”¾å›é‡‡æ ·
```

### 2.5 ä¸‰é˜¶æ®µè®­ç»ƒ âœ“
```python
class XRaSPINNSolver:
    def train(...):
        # Phase 1: è¿œåœºé¢„è®­ç»ƒ (N_pre epochs)
        # Phase 2: è£‚å°–èšç„¦ + RAS (N_adapt cycles)
        # Phase 3: è”åˆç²¾åŒ– (N_joint epochs)
```

### å¯è§†åŒ– âœ“
```python
def visualize_sampling(x_sing, x_far, save_path)
    # ç”Ÿæˆ figs/xras_sampling_scatter.png
    # æ˜¾ç¤ºä¸¤åŸŸç‚¹åˆ†å¸ƒã€è£‚å°–ä½ç½®ã€åŒºåŸŸè¾¹ç•Œ
```

## ğŸ“Š æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹

è¿è¡Œæµ‹è¯•æ—¶ï¼Œä½ å°†çœ‹åˆ°ï¼š

```
======================================================================
PHASE 1: Far-field Pretraining (100 epochs)
======================================================================
  Epoch    0 | Loss: 2.345e-03 | Energy_far: 1.234e-03 | BC: 1.111e-03
  ...

======================================================================
PHASE 2: Singular Focusing with RAS (2 cycles)
======================================================================

--- Adaptation Cycle 1/2 ---
Current x_sing size: 87
  Epoch    0 | Total: 3.456e-03 | E_sing: 1.234e-03 | ...
  ...
  Computing indicators for adaptive sampling...
  Added 20 points. New x_sing size: 107

--- Adaptation Cycle 2/2 ---
Current x_sing size: 107
  ...

======================================================================
PHASE 3: Joint Refinement (100 epochs)
======================================================================
  Epoch    0 | Total: 2.789e-03 | ...
  ...

======================================================================
Training completed!
Final x_sing size: 127
======================================================================
```

## ğŸ¯ è‡ªå®šä¹‰ä½¿ç”¨

### åŸºæœ¬æ¨¡æ¿

```python
from phase_field_vpinn import XRaSPINNSolver
import torch
import numpy as np

# 1. é…ç½®é—®é¢˜
config = {
    # ææ–™å‚æ•°
    'E': 210e3,      # æ¨æ°æ¨¡é‡
    'nu': 0.3,       # æ³Šæ¾æ¯”
    'G_c': 2.7,      # æ–­è£‚èƒ½
    'l': 0.015,      # é•¿åº¦å°ºåº¦
    
    # åŸŸåˆ†è§£
    'crack_tip': np.array([x_tip, y_tip]),
    'r_sing': 0.15,  # è£‚å°–åŒºåŸŸåŠå¾„
    
    # è®­ç»ƒå‚æ•°
    'lr_u': 1e-3,
    'lr_d': 1e-3,
    
    # æŸå¤±æƒé‡
    'weights': {
        'lambda_bc': 100.0,   # è¾¹ç•Œæ¡ä»¶
        'lambda_int': 10.0,   # æ¥å£æŸå¤±
        'w_u': 1.0,           # ä½ç§»è¿ç»­
        'w_sigma': 1.0,       # ç‰µå¼•åŠ›å¹³è¡¡
    }
}

# 2. å‡†å¤‡é‡‡æ ·ç‚¹
x_sing_init = ...  # è£‚å°–åŒºåˆå§‹ç‚¹
x_far = ...        # è¿œåœºç‚¹
x_bc = ...         # è¾¹ç•Œç‚¹
u_bc = ...         # è¾¹ç•Œæ¡ä»¶
x_I = ...          # æ¥å£ç‚¹
normal_I = ...     # æ¥å£æ³•å‘é‡

# 3. åˆ›å»ºæ±‚è§£å™¨
solver = XRaSPINNSolver(config)

# 4. è®­ç»ƒ
train_config = {
    'N_pre': 2000,     # Phase 1
    'N_adapt': 5,      # Phase 2 å¾ªç¯æ¬¡æ•°
    'N_inner': 1000,   # Phase 2 æ¯æ¬¡å¾ªç¯
    'N_joint': 2000,   # Phase 3
    'N_add': 100,      # æ¯æ¬¡æ·»åŠ ç‚¹æ•°
    'beta': 0.5,       # èåˆæƒé‡
}

results = solver.train(
    x_sing_init, x_far, x_bc, u_bc, 
    x_I, normal_I, train_config
)

# 5. é¢„æµ‹
u, d = solver.predict(x_test)

# 6. å¯è§†åŒ–
solver.visualize_sampling(
    results['x_sing_final'], 
    results['x_far'],
    'my_sampling.png'
)
```

## ğŸ”§ å‚æ•°è°ƒä¼˜å»ºè®®

### åŸŸåˆ†è§£å‚æ•°
- `r_sing`: é€šå¸¸è®¾ä¸ºåŸŸå°ºå¯¸çš„ 10%-20%
  - å¤ªå°ï¼šé‡‡æ ·ç‚¹ä¸è¶³ï¼Œéš¾ä»¥æ•æ‰å¥‡å¼‚æ€§
  - å¤ªå¤§ï¼šè®¡ç®—æˆæœ¬å¢åŠ 

### è®­ç»ƒå‚æ•°
- **å¿«é€Ÿæµ‹è¯•**: N_pre=100, N_adapt=2, N_inner=50, N_joint=100
- **æ ‡å‡†è´¨é‡**: N_pre=1000, N_adapt=3, N_inner=500, N_joint=1000
- **é«˜è´¨é‡**: N_pre=2000, N_adapt=5, N_inner=1000, N_joint=2000

### è‡ªé€‚åº”é‡‡æ ·
- `N_add`: å»ºè®® 50-100ï¼ˆæ¯æ¬¡å¾ªç¯ï¼‰
- `beta`: 
  - 0.3-0.4: åé‡åº”å˜èƒ½ï¼ˆåº”åŠ›é›†ä¸­ï¼‰
  - 0.5: ç­‰æƒé‡ï¼ˆæ¨èï¼‰
  - 0.6-0.7: åé‡æŸä¼¤æ¢¯åº¦ï¼ˆè£‚çº¹å‰æ²¿ï¼‰

### æŸå¤±æƒé‡
- `lambda_bc`: 100-1000ï¼ˆè¾¹ç•Œæ¡ä»¶å¾ˆé‡è¦ï¼‰
- `lambda_int`: 10-50ï¼ˆæ¥å£è€¦åˆï¼‰
- `w_u`, `w_sigma`: é€šå¸¸ 1.0ï¼ˆå¯æ ¹æ®æ”¶æ•›æƒ…å†µè°ƒæ•´ï¼‰

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: è®­ç»ƒä¸æ”¶æ•›
**å¯èƒ½åŸå› **:
- å­¦ä¹ ç‡å¤ªå¤§
- è¾¹ç•Œæ¡ä»¶æƒé‡å¤ªå°
- æ¥å£ç‚¹å¤ªå°‘

**è§£å†³æ–¹æ¡ˆ**:
```python
# é™ä½å­¦ä¹ ç‡
'lr_u': 5e-4, 'lr_d': 5e-4

# å¢åŠ è¾¹ç•Œæƒé‡
'lambda_bc': 500.0

# å¢åŠ æ¥å£ç‚¹
n_interface = 100  # åŸæ¥å¯èƒ½æ˜¯ 40
```

### é—®é¢˜ 2: æŸä¼¤åœºä¸åˆç†ï¼ˆå…¨0æˆ–å…¨1ï¼‰
**å¯èƒ½åŸå› **:
- G_c æˆ– l å‚æ•°ä¸åˆé€‚
- å†å²åœºæœªæ­£ç¡®åˆå§‹åŒ–

**è§£å†³æ–¹æ¡ˆ**:
```python
# è°ƒæ•´ç›¸åœºå‚æ•°
'G_c': 2.7,    # å¢åŠ  â†’ è£‚çº¹æ›´éš¾æ‰©å±•
'l': 0.015,    # å¢åŠ  â†’ è£‚çº¹å¸¦æ›´å®½
```

### é—®é¢˜ 3: è‡ªé€‚åº”é‡‡æ ·ä¸å·¥ä½œ
**æ£€æŸ¥**:
```python
# ç¡®ä¿å€™é€‰ç‚¹è¶³å¤Ÿå¤š
print(f"Candidate points: {len(x_cand)}")
# åº”è¯¥ >> N_add

# æ£€æŸ¥æŒ‡æ ‡èŒƒå›´
print(f"Indicator range: [{eta.min()}, {eta.max()}]")
# ä¸åº”è¯¥å…¨æ˜¯0æˆ–å…¨ç›¸ç­‰
```

## ğŸ“– ä»£ç ç»“æ„è¯´æ˜

### Phase-1 (åŸæœ‰)
- `DisplacementNetwork`, `DamageNetwork`: ç¥ç»ç½‘ç»œ
- `compute_strain`, `compute_energy_split`: è‡ªåŠ¨å¾®åˆ†
- `DRMLoss`: èƒ½é‡æ³›å‡½æŸå¤±
- `PhaseFieldSolver`: å•åŸŸæ±‚è§£å™¨

### Phase-2 (æ–°å¢)
- `partition_domain`: åŸŸåˆ†è§£å‡½æ•°
- `build_phase_field_network`: ç½‘ç»œæ„å»º
- `compute_stress`: åº”åŠ›è®¡ç®—
- `compute_interface_loss`: æ¥å£æŸå¤±
- `compute_indicator`: èåˆæŒ‡æ ‡
- `resample_points`: é‡è¦æ€§é‡‡æ ·
- `XRaSPINNSolver`: X-RAS-PINN æ±‚è§£å™¨

## ğŸ“š ç†è®ºèƒŒæ™¯

### XPINN (Extended PINN)
åœ¨åŸŸ Î© = Î©_sing âˆª Î©_far ä¸Šä½¿ç”¨ä¸¤ç»„ç½‘ç»œï¼š
- è£‚å°–åŸŸï¼šé«˜å®¹é‡ç½‘ç»œï¼Œæ•æ‰å¥‡å¼‚æ€§
- è¿œåœºåŸŸï¼šæ ‡å‡†ç½‘ç»œï¼Œé™ä½è®¡ç®—æˆæœ¬

### RAS (Residual-based Adaptive Sampling)
æ ¹æ®ç‰©ç†æŒ‡æ ‡åŠ¨æ€å¢åŠ é‡‡æ ·ç‚¹ï¼š
```
Î·(x) = (1-Î²)Â·SED(x)/max(SED) + Î²Â·|âˆ‡d(x)|/max(|âˆ‡d|)
p(x) âˆ Î·(x)
```

### ä¸‰é˜¶æ®µè®­ç»ƒç­–ç•¥
1. **è¿œåœºé¢„è®­ç»ƒ**: å»ºç«‹ç¨³å®šçš„è¿œåœºè§£
2. **è£‚å°–èšç„¦**: ä¸“æ³¨å­¦ä¹ å¥‡å¼‚æ€§ï¼ŒåŒæ—¶è‡ªé€‚åº”åŠ å¯†
3. **è”åˆç²¾åŒ–**: å…¨å±€ä¼˜åŒ–ï¼Œç¡®ä¿ä¸€è‡´æ€§

## ğŸ“§ æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ§åˆ¶å°è¾“å‡ºçš„ loss æ˜¯å¦ä¸‹é™
2. é‡‡æ ·ç‚¹æ•°æ˜¯å¦åœ¨å¢åŠ 
3. å¯è§†åŒ–ç»“æœæ˜¯å¦åˆç†

å…³é”®æ£€æŸ¥ç‚¹ï¼š
- Phase 1 ç»“æŸï¼šè¿œåœºæŸå¤±åº”æ˜¾è‘—ä¸‹é™
- Phase 2 æ¯ä¸ªå¾ªç¯ï¼šæ‰“å° "Added X points"
- Phase 3 ç»“æŸï¼šæ¥å£æŸå¤±åº”è¾ƒå°ï¼ˆ<1e-3ï¼‰

---

**æœ€åæ›´æ–°**: 2025-11-14
**ç‰ˆæœ¬**: Phase-2 Complete Implementation
